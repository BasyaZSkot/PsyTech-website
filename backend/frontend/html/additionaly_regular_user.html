<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Document</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center">
    <div class="w-1/2 bg-white p-6 rounded-lg shadow-lg">
        <form id="multiSelectForm" method="post">
            {% csrf_token %}
            {% for i in form %}
                <div class="mb-4">
                    <label for="{{ i.id_for_my_label }}" class="block text-lg font-medium text-gray-700 mb-2">{{ i.label }}</label>
                    {{ i }}
                </div>
            {% endfor %}

            <div class="mb-4">
                <label for="prefer_methods" class="block text-lg font-medium text-gray-700 mb-2">Preferred Methods to Chat</label>
                <select id="prefer_methods" multiple class="block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    <option value="Web Site Chat">Web-Site Chat</option>
                    <option value="Whatsapp">WhatsApp</option>
                    <option value="Telegram">Telegram</option>
                    <option value="Vk">VK</option>
                    <option value="Email">Email</option>
                </select>
            </div>

            <div id="method_details">
                <input type="hidden" name="contacts" id="method-details-input">
            </div>

            <div class="mb-4">
                <h2 class="text-center mb-6">Select Your Timeslots</h2>
                
                <!-- Timeslots Grid -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <!-- Single Timeslot Item -->
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="0" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">0:00-0:50</span>
                    </label>

                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="1" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">1:00-1:50</span>
                    </label> 
        
                    <label class="flex items-center p-4 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="2" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">2:00-2:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="3" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">3:00-3:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="4" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">4:00-4:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="5" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">5:00-5:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="6" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">6:00-6:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="7" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">7:00-7:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="8" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">8:00-8:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="9" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">9:00-9:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="10" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">10:00-10:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="11" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">11:00-11:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="12" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">12:00-12:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="13" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">13:00-13:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="14" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">14:00-14:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="15" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">15:00-15:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="16" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">16:00-16:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="17" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">17:00-17:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="18" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">18:00-18:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="19" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">19:00-19:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="20" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">20:00-20:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="21" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">21:00-21:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="22" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">22:00-22:50</span>
                    </label>
        
                    <label class="flex items-center p-2 bg-gray-50 border rounded-lg shadow-sm cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" id="23" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-3 text-lg font-medium">23:00-23:50</span>
                    </label>
                    <input type="hidden" name="time-slots" id="time-slots-details">
                </div>
                <br>
            <!-- Other form elements -->
            
            <div class="flex justify-end">
                <button type="submit" class="bg-indigo-500 text-white px-4 py-2 rounded-md hover:bg-indigo-600 focus:outline-none">Submit</button>
            </div>
        </form>
    </div>
    <script>
        var method_input = document.getElementById("method-details-input");
        const element = document.getElementById('prefer_methods');
        const choices = new Choices(element, {
            removeItemButton: true,
            searchEnabled: true,
        });
        const time_slots_details = {}
        const tm_sl_input = document.getElementById("time-slots-details")
        for (let index = 0; index < 24; index++) {
            document.getElementById(index.toString()).addEventListener('change', function(event){
                event.preventDefault()
                
                if (document.getElementById(index.toString()).checked){
                    time_slots_details[index] = "+"
                    tm_sl_input.value = JSON.stringify(time_slots_details)
                } else {
                    time_slots_details[index] = "-"
                    tm_sl_input.value = JSON.stringify(time_slots_details)
                }
            })
        }
    
        // Initialize an object to store the method details
        let methodDetails = {};
    
        // Handle changes in the select element
        element.addEventListener('change', function (event) {
            event.preventDefault();
            const selectedMethods = choices.getValue(true);
            const methodDetailsDiv = document.getElementById('method_details');
    
            // Clear all dynamic input fields that are not in the selected methods
            Array.from(methodDetailsDiv.children).forEach(child => {
                if (!selectedMethods.includes(child.id)&&child.id!="method-details-input") {
                    child.remove(); // Remove the input if it's not in the selected methods
                    delete methodDetails[child.id]; // Remove from the methodDetails object
                }
            });
    
            selectedMethods.forEach(method => {
                if (!document.getElementById(method)) {
                    let containerDiv = document.createElement("div");
                    containerDiv.className = "mb-4";
                    containerDiv.id = method;
    
                    let label = document.createElement("label");
                    let input = document.createElement("input");
                    
    
                    if (method === 'Telegram') {
                        methodDetails[method] = ""
                        label.htmlFor = `${method}_contact`;
                        label.className = "block text-lg font-medium text-gray-700 mb-2";
                        label.innerText = `Your username for ${method.charAt(0).toUpperCase() + method.slice(1)}`;
                        
                        input.type = "text";
                        input.required = true;
                        input.className = "block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm";
                        input.id = `${method}_contact`;
                        input.placeholder = `Enter your username for ${method}`;
                        containerDiv.addEventListener("input", function(){
                            updateMethodDetails(method);
                        });
                        let helpText = document.createElement("label");
                        helpText.htmlFor = "help_text";
                        helpText.className = "block font-medium text-gray-700 mb-2";
                        helpText.innerText = "*To find your username, go to your Telegram account settings and copy what's written after the '@' symbol.";
                         
                        containerDiv.appendChild(label);
                        containerDiv.appendChild(input);
                        containerDiv.appendChild(helpText);
    
                    } else if (method === 'Whatsapp') {
                        methodDetails[method] = ""
                        label.htmlFor = `${method}_contact`;
                        label.className = "block text-lg font-medium text-gray-700 mb-2";
                        label.innerText = `Your number for ${method.charAt(0).toUpperCase() + method.slice(1)}`;
    
                        input.type = "text";
                        input.required = true;
                        input.className = "block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm";
                        input.id = `${method}_contact`;
                        input.placeholder = `Enter your number for ${method}`;
                        input.addEventListener('input', function(){
                            updateMethodDetails(method);
                        })
    
                        containerDiv.appendChild(label);
                        containerDiv.appendChild(input);
    
                    } else if (method === 'Vk') {
                        methodDetails[method] = ""
                        label.htmlFor = `${method}_contact`;
                        label.className = "block text-lg font-medium text-gray-700 mb-2";
                        label.innerText = `Your name/username for ${method.charAt(0).toUpperCase() + method.slice(1)}`;
    
                        input.type = "text";
                        input.required = true;
                        input.className = "block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm";
                        input.id = `${method}_contact`;
                        input.placeholder = `Enter your name/username for ${method}`;
                        input.oninput = function () { updateMethodDetails(method, this.value); };
    
                        containerDiv.appendChild(label);
                        containerDiv.appendChild(input);
                        containerDiv.addEventListener("input", function(){
                            updateMethodDetails(method);
                        });
    
                    } else {
                        methodDetails[method] = ""
                        containerDiv.style.display = "none";
                    }
    
                    methodDetailsDiv.appendChild(containerDiv);
                }
            });
    
            // Update the hidden input with the serialized details of the methods
            updateMethodInput();
        });
    
        // Function to update the method details object
        function updateMethodDetails(method) {
            const value = document.getElementById(method+"_contact").value
            methodDetails[method] = value;
            updateMethodInput();
        }
    
        // Function to update the hidden input field
        function updateMethodInput() {
            method_input.value = JSON.stringify(methodDetails);
        }
    
        // Initialize hidden input value
        updateMethodInput();
    </script>
    
    
</body>
</html>
