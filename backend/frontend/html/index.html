{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ name }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">    
</head>
<body>
    <div id="user-instruments">
        <button id="arrow-right"><i class="fa-solid fa-arrow-right-to-bracket fa-2xl"></i></button>
        <button id="arrow-left"><i class="fa-solid fa-arrow-right-to-bracket fa-2xl"></i></button>
        {% if user.is_authenticated %}
            <div id="user-info">
                {% if no_image %}
                    <button id="gear" onclick="settingsBarOpen()"><div id="like-image"><h2 style="color: white;">{{ user_info.user.username.0 }}</h2></div></button>
                {% else %}
                    <button id="gear" onclick="settingsBarOpen()"><img id="image" src="files/{{ user_info.profile_picture.name }}"></button>
                {% endif %}
            </div>
            <div id="notifications">
                <button class="notifications_but" onclick="document.getElementById('notifications').classList.remove('overlay')"><i class="fa-solid fa-bell fa-2xl"></i></button>
                <div class="main_content">
                    {%  if notifications.no_notif %}
                        <h1 class="error_message">No message yet</h1>
                    {% else %}
                        <ul>
                            {% for object in notifications.summaries %}
                                <li class="content">User {{ object.sender.username }} send <a href="{% url 'summaries_view' object.id %}">a summary</a></li>
                            {% endfor %}
                        </ul>
                        <ul>
                            {% if notifications.summary_confirmation %}
                                <li class="content">You are suitable for us, the final decision will be made during the call. You can arrange a call via <a href="{% url 'chat' notifications.my_summary.id %}">chat</a></li>
                            {% elif notifications.summary_confirmation is False  %}  
                                <li class="content">Sorry, but you are not suitable for us. <a href="{% url 'summary_mistakes_view' notifications.reject_message.id %}">Click to see your mistakes or flaws</a></li>
                            {% endif %}
                        </ul>
                        <ul>
                            {% for object in notifications.meeting_messages %}
                                {% if 'notifications.user_group=="regular user"'  %}
                                    <li class="content">Psihologyst {{ object.sender.username }} can meet you. You can agree with him/her in <a href="{% url 'chat' object.id %}">chat</a></li>
                                {% elif 'notifications.user_group =="confirm psihologyst"' %}
                                    <li class="content">User {{ object.sender.username }} want to meet with you.</li> <!-- Link to confirm/reject request -->
                                {% endif %}
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>
            <button class="notifications_but" onclick="document.getElementById('notifications').classList.add('overlay')"><i class="fa-solid fa-bell fa-2xl"></i></button><br>
            <div id="chats">
                <button class="chats_but" onclick="document.getElementById('chats').classList.remove('overlay')"><i class="fa-solid fa-comments fa-2xl"></i></button><br>
                {% if no_chats is False %}
                    <ul class="chats">
                        {% for chat in chats %}
                            {% if chat.0 is False %}
                            <li class="chat" id="{{ chat.1.id }}">
                                    <a href="{% url 'chat' chat.1.id %}">
                                    <h2>{{ chat.3.username }}</h2>
                                    <p>{{ chat.2 }}</p>
                                    </a>
                                </li>
                            {% else %}
                                <li class="chat" id="{{ chat.0.id }}">
                                    <a href="{% url 'chat' chat.0.id %}">
                                        <h2>{{ chat.0.user.username }}</h2>
                                        <p>{{ chat.1 }}</p>
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                {% else %}
                    <h2>No chats yet</h2>
                {% endif %}
            </div>
            <button class="chats_but" onclick="document.getElementById('chats').classList.add('overlay')"><i class="fa-solid fa-comments fa-2xl"></i></button>
            <div id="settingsBar">
                <ul>
                    <li><a href="{% url 'account_logout' %}"><i class="fa-solid fa-right-from-bracket" style="color: black;"></i>Logout</a><br></li>
                    <li><a href="{% url 'settings' %}"><i class="fa-solid fa-gears"></i>Settings</a></li>
                </ul>
            </div>
        {% else %}
            <p><a href="{% url 'account_login' %}">Sign in</a>/ <a href="{% url 'account_signup' %}"> Sign up</a></p>
        {% endif %}
    </div>
    
    <div class="psihologysts">
        <ul>
        {% for psihologyst in psihologysts_info %}
            <li>
                <div id="{{ psihologyst.id }}">
                    <img src="files/{{ psihologyst.profile_picture.name }}">
                    <p>{{ psihologyst.user.username }}</p>
                    <a href="{% url 'psihologyst_detail_view' psihologyst.user.id %}">More</a>
                </div>
            </li>
        {% endfor %}
        </ul>
    </div>
    <script>
        const bar = document.getElementById("settingsBar");
        var count = 0;
        function settingsBarOpen() {
            if (count % 2 === 0){
                bar.style.display = "block";
            } else {
                bar.style.display = "none";
            }
            count = count + 1;
        }

        const panel = document.getElementById('user-instruments');
        document.getElementById('arrow-right').addEventListener('click', function() {
            panel.classList.add('open');
            document.getElementById('arrow-right').style.display = "none";
            document.getElementById('arrow-left').style.display = "block";
        });

        document.getElementById('arrow-left').addEventListener('click', function() {
            panel.classList.remove('open');
            document.getElementById('arrow-left').style.display = "none";
            document.getElementById('arrow-right').style.display = "block";
        });
    </script>
</body>
</html>